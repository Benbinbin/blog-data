<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.27">
    <link rel="icon" href="/blog-data/images/favicon.ico"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.5/dist/katex.min.css"><title>形状 | Blog</title><meta name="description" content="A blog and knowledge management system about data and visualization.">
    <link rel="modulepreload" href="/blog-data/assets/app.a4413a59.js"><link rel="modulepreload" href="/blog-data/assets/形状.html.64d0c9da.js"><link rel="modulepreload" href="/blog-data/assets/plugin-vue_export-helper.21dcd24c.js"><link rel="modulepreload" href="/blog-data/assets/形状.html.79e58ba4.js">
    <link rel="stylesheet" href="/blog-data/assets/style.b42fd117.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="min-h-screen flex flex-col"><nav class="px-4 sm:px-8 py-2 flex justify-between items-center sticky top-0 z-30 bg-white"><div class="left flex items-center space-x-0.5"><!--[--><button class="text-gray-400 hover:bg-gray-100 catelog-btn p-2 select-none text-sm font-bold hover:text-gray-900 rounded-md lg:hidden"><svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="currentColor" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M5 11.5a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5zm-3 1a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm0 4a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm0 4a1 1 0 1 0 0-2 1 1 0 0 0 0 2z"></path></svg></button><!--]--><a class="avatar p-2 hover:bg-gray-100 rounded-md" href="/blog-data/#"><img src="/blog-data/images/avatar.png" alt="avatar" class="w-10 h-10 rounded-full"></a></div><div class="right hidden sm:flex items-center space-x-0.5"><!--[--><button class="text-gray-400 p-2 select-none text-sm font-bold hover:text-gray-900 hover:bg-gray-100 rounded-md">All</button><button class="text-gray-400 p-2 select-none text-sm font-bold hover:text-gray-900 hover:bg-gray-100 rounded-md">Anaconda</button><button class="text-gray-400 p-2 select-none text-sm font-bold hover:text-gray-900 hover:bg-gray-100 rounded-md">Jupyter</button><button class="text-gray-400 p-2 select-none text-sm font-bold hover:text-gray-900 hover:bg-gray-100 rounded-md">Math</button><button class="text-gray-400 p-2 select-none text-sm font-bold hover:text-gray-900 hover:bg-gray-100 rounded-md">Python</button><button class="text-gray-400 p-2 select-none text-sm font-bold hover:text-gray-900 hover:bg-gray-100 rounded-md">Vis</button><!--]--><!--[--><button class="text-gray-900 bg-gray-100 hover:bg-gray-200 p-2 select-none text-sm font-bold hover:text-gray-900 rounded-md hidden lg:block"><svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="currentColor" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M5 11.5a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5zm-3 1a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm0 4a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm0 4a1 1 0 1 0 0-2 1 1 0 0 0 0 2z"></path></svg></button><!--]--></div><div class="more-container sm:hidden relative"><button style="" class="p-2 select-none hover:bg-gray-100 rounded-md text-gray-500"><svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="currentColor" viewBox="0 0 16 16"><path d="M9.5 13a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0zm0-5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0zm0-5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0z"></path></svg></button><button style="display:none;" class="p-2 select-none hover:bg-gray-100 rounded-md text-red-400 hover:text-red-500"><svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="currentColor" viewBox="0 0 16 16"><path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"></path><path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"></path></svg></button><div style="display:none;" class="more-modal p-2 absolute top-10 right-0 z-10 flex flex-col space-y-2 bg-gray-100 rounded-md opacity-90"><!--[--><button class="text-gray-400 px-4 py-2 select-none text-sm text-center font-bold hover:text-gray-900 hover:bg-gray-200 rounded-md">All</button><button class="text-gray-400 px-4 py-2 select-none text-sm text-center font-bold hover:text-gray-900 hover:bg-gray-200 rounded-md">Anaconda</button><button class="text-gray-400 px-4 py-2 select-none text-sm text-center font-bold hover:text-gray-900 hover:bg-gray-200 rounded-md">Jupyter</button><button class="text-gray-400 px-4 py-2 select-none text-sm text-center font-bold hover:text-gray-900 hover:bg-gray-200 rounded-md">Math</button><button class="text-gray-400 px-4 py-2 select-none text-sm text-center font-bold hover:text-gray-900 hover:bg-gray-200 rounded-md">Python</button><button class="text-gray-400 px-4 py-2 select-none text-sm text-center font-bold hover:text-gray-900 hover:bg-gray-200 rounded-md">Vis</button><!--]--></div></div></nav><div class="relative flex-grow"><div class="theme-container no-navbar no-sidebar"><!--[--><!----><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><!----><!--[--><!--]--><ul class="sidebar-links"><!--[--><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><h1 id="形状" tabindex="-1"><a class="header-anchor" href="#形状" aria-hidden="true">#</a> 形状</h1><p>参考：</p><ul><li><a href="https://observablehq.com/@d3/learn-d3-shapes?collection=@d3/learn-d3" target="_blank" rel="noopener noreferrer">Learn D3: Shapes</a></li><li><a href="https://github.com/d3/d3/blob/main/API.md#shapes-d3-shape" target="_blank" rel="noopener noreferrer">Shapes (d3-shape)</a></li><li><a href="https://github.com/d3/d3-shape" target="_blank" rel="noopener noreferrer">d3-shape</a>（非官方<a href="https://github.com/xswei/d3-shape" target="_blank" rel="noopener noreferrer">中译版</a>）</li></ul><p>本文主要介绍 <mark><a href="https://observablehq.com/@d3/learn-d3-shapes?collection=@d3/learn-d3" target="_blank" rel="noopener noreferrer">Shapes</a> 模块</mark>。</p><p>一个完整的可视化作品是由多种<strong>基本的图形符号</strong>构成的，例如饼图由多个扇形 arcs 构成，折线图由多段线 lines 构成，面积图由一个或多个面积 areas 构成，而且图中还可能使用符号 symbols（如星形、三角形、圆形等）作注释等。</p><p>SVG 提供了了不同的元素构建基本的图形符号，例如 <code>&lt;rect&gt;</code> 元素可以绘制出矩形（或圆角矩形），<code>&lt;path&gt;</code> 元素可以绘制出复杂的图形。但是「手动」设置这些元素的参数以绘制出期望的形状（例如 <code>&lt;path&gt;</code> 元素需要设置属性 <code>d</code>，该属性值是由一系列 <code>M</code>、<code>L</code> 等命令和 <code>x y</code> 坐标点数据组成的字符串）是十分繁琐的。</p><p>在 <a href="https://github.com/d3/d3-shape" target="_blank" rel="noopener noreferrer">d3-shape</a> 模块中包含各种基本图形生成器，可以方便地基于抽象数据生成所需的图形。</p><p>可以直接用于生成图形的生成器，一般会生成可用于 <code>&lt;path&gt;</code> 元素属性 <code>d</code> 的值：</p><ul><li><p><strong>Arcs 扇形/环形生成器</strong>：基于内外半径和开角，绘制出扇形</p></li><li><p><strong>Lines 线段生成器</strong>：基于坐标点，直接将一系列的坐标点相连绘制出折线</p></li><li><p><strong>Areas 面积生成器</strong>：和线段生成器类似，不过它需要基于上下两条边界线，用以绘制出面积</p></li><li><p><strong>Links 连线生成器</strong>：基于两个坐标点，绘制出平滑的三次贝塞尔曲线作为两点之间的连线</p></li><li><p><strong>Symbols 符号生成器</strong>：提供了一系列常用的符号，一般用于散点图中以表示数据的类别</p></li></ul><p>不可直接用于生成图形的生成器，需要配合上方的生成器使用：</p><ul><li><p><strong>Pie 饼图角度生成器</strong>：返回一个关于角度的数组，然后将这些角度数据用于 Arcs 扇形/环形生成器</p></li><li><p><strong>Curves 曲线插值生成器</strong>：配合 Lines 线段生成器使用，设置坐标点之间的插值方式（D3 内置了多种方式），以绘制出更平滑的线段</p></li><li><p><strong>Custom Curves 自定义曲线插值生成器</strong>：自定义坐标点之间的插值函数，配合 Lines 线段生成器使用</p></li><li><p><strong>Custom Symbol Types 自定义符号类型生成器</strong>：通过 <code>symbol.type</code> 将自定义的图形符号设置为符号的类型</p></li><li><p><strong>Stacks 堆叠生成器</strong>：基于数据计算出堆叠的方式，需要将这些数据传递给 Areas 面积生成器</p></li></ul><h2 id="扇形生成器-arcs" tabindex="-1"><a class="header-anchor" href="#扇形生成器-arcs" aria-hidden="true">#</a> 扇形生成器 Arcs</h2><p>扇形生成器 Arcs 用以生成一个个扇形或环形，然后将多个扇形或环形拼起来就构成了饼图或圆环图。</p><p><mark>使用方法 <code>d3.arc()</code> 创建一个扇形生成器（以下称为 <code>arc</code>）。</mark></p><p>它既是一个方法，可以直接调用，<strong>传递</strong>一个包含多个设置参数的<strong>对象</strong>作为入参（实际这些参数在内部被相应的方法调用），来创建一个扇形；它也是一个对象，具有多种方法设置不同的参数，一般通过<strong>链式调用</strong>的方式来使用。</p><p>💡 调用扇形生成器时返回的结果，基于扇形生成器是否设置了<strong>父容器 context</strong> 而不同。如果扇形生成器设置了父容器（一般是选择集，如 <code>&lt;g&gt;</code> 元素），则生成 <code>&lt;path&gt;</code> 元素，并添加到父容器中；如果没有入参，则生成可用于作为 <code>&lt;path&gt;</code> 元素的属性 <code>d</code> 的属性值的字符串。</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 创建一个默认的扇形生成器</span>
<span class="token keyword">const</span> arc <span class="token operator">=</span> d3<span class="token punctuation">.</span><span class="token function">arc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 在调用生成器时需要传递相关的设置参数（半径和角度）</span>
<span class="token comment">// 适用于动态生成各种形状的扇形</span>
<span class="token function">arc</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  innerRadius<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  outerRadius<span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">,</span>
  startAngle<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  endAngle<span class="token operator">:</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">/</span> <span class="token number">2</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;M0,-100A100,100,0,0,1,100,0L0,0Z&quot;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 创建一个扇形生成器，并设置了相应的参数</span>
<span class="token keyword">const</span> arc <span class="token operator">=</span> d3<span class="token punctuation">.</span><span class="token function">arc</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">innerRadius</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">outerRadius</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">startAngle</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">endAngle</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 当扇形生成器已经设置了半径和角度，可以直接调用，生成路径</span>
<span class="token function">arc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;M0,-100A100,100,0,0,1,100,0L0,0Z&quot;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>💡 这两种创建和调用方式可混合使用，例如需要创建一系列半径相同，但角度不同的扇形，可以创建一个扇形生成器并预设了半径，然后在调用生成器时才传递角度信息</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 包含一系列扇形角度（开始和结束的角度，单位是弧度）的数组</span>
<span class="token keyword">const</span> angleArr <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
        start<span class="token operator">:</span> <span class="token number">0</span> <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span><span class="token punctuation">,</span>
        end<span class="token operator">:</span> <span class="token number">1</span><span class="token operator">/</span><span class="token number">4</span> <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// ...</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">]</span>

<span class="token comment">// 创建一个预设了半径的扇形生成器，开始角度和结束角度以参数的形式传入</span>
arc <span class="token operator">=</span> d3<span class="token punctuation">.</span><span class="token function">arc</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">innerRadius</span><span class="token punctuation">(</span><span class="token number">210</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">outerRadius</span><span class="token punctuation">(</span><span class="token number">310</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">startAngle</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">[</span>startAngle<span class="token punctuation">,</span> endAngle<span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> startAngle<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">endAngle</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">[</span>startAngle<span class="token punctuation">,</span> endAngle<span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> endAngle<span class="token punctuation">)</span>

<span class="token keyword">const</span> pathArr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
angleArr<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">angle</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    pathArr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token function">arc</span><span class="token punctuation">(</span><span class="token punctuation">[</span>angleArr<span class="token punctuation">.</span>start<span class="token punctuation">,</span> angleArr<span class="token punctuation">.</span>end<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p>💡 生成的扇形的中心坐标默认是 <code>(0, 0)</code>，可以为扇形的父容器（一般是元素 <code>&lt;g&gt;</code>）设置 <code>transform</code> 属性，移动到目标位置</p><p>💡 在官方<a href="https://observablehq.com/collection/@d3/d3-shape" target="_blank" rel="noopener noreferrer">样例</a>和<a href="https://github.com/d3/d3-shape" target="_blank" rel="noopener noreferrer">文档</a>中，常常见到 <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.1132em;">τ</span></span></span></span> 符号，它表示 <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">2</span><span class="mord mathnormal" style="margin-right:0.03588em;">π</span></span></span></span></p><p>扇形生成器具有的方法，这些方法一般都返回扇形生成器本身，便于进行<strong>链式调用</strong>：</p><ul><li><p><code>arc.centroid()</code> 计算扇形的「中点」，即位于弧度是 <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal">s</span><span class="mord mathnormal">t</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">t</span><span class="mord mathnormal">A</span><span class="mord mathnormal">n</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">e</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">e</span><span class="mord mathnormal">n</span><span class="mord mathnormal">d</span><span class="mord mathnormal">A</span><span class="mord mathnormal">n</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">e</span><span class="mclose">)</span><span class="mord">/2</span></span></span></span> 半径是 <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal">inn</span><span class="mord mathnormal" style="margin-right:0.02778em;">er</span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="mord mathnormal">a</span><span class="mord mathnormal">d</span><span class="mord mathnormal">i</span><span class="mord mathnormal">u</span><span class="mord mathnormal">s</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">o</span><span class="mord mathnormal">u</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right:0.02778em;">er</span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="mord mathnormal">a</span><span class="mord mathnormal">d</span><span class="mord mathnormal">i</span><span class="mord mathnormal">u</span><span class="mord mathnormal">s</span><span class="mclose">)</span><span class="mord">/2</span></span></span></span> 的点，一般将扇形的文本注释添加到此 ⚠️ 该点可能不在扇形/环形内部</p></li><li><p><code>arc.innerRadius([radius])</code> 设置内半径，入参可以是一个数值，或是返回数值的函数；如果没有入参，则返回当前的内半径。如果 <code>radius=0</code> 则生成扇形，如果 <code>radius</code> 不为零则生成环形</p></li><li><p><code>arc.outerRadius([radius])</code> 设置外半径</p><p>💡 如果内半径大于外半径，则 D3 会见两者调换；如果入参是负值则会被当作 <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">0</span></span></span></span></p></li><li><p><code>arc.cornerRadius([radius])</code> 设置圆角的半径，对于扇形则设置外侧的两个角；对于环形则设置内外侧的四个角。但是圆角的半径不会大于 <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal">o</span><span class="mord mathnormal">u</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right:0.02778em;">er</span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="mord mathnormal">a</span><span class="mord mathnormal">d</span><span class="mord mathnormal">i</span><span class="mord mathnormal">u</span><span class="mord mathnormal">s</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">inn</span><span class="mord mathnormal" style="margin-right:0.02778em;">er</span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="mord mathnormal">a</span><span class="mord mathnormal">d</span><span class="mord mathnormal">i</span><span class="mord mathnormal">u</span><span class="mord mathnormal">s</span><span class="mclose">)</span><span class="mord">/2</span></span></span></span> 而且当两个相邻的圆角靠得太近时，<a href="https://bl.ocks.org/mbostock/b7671cb38efdfa5da3af" target="_blank" rel="noopener noreferrer">圆角半径会减小</a>，一般出现在环形的弧长小于 <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">π</span></span></span></span> 的内侧圆角。</p><p><img src="/blog-data/assets/corner-radius.b6523e66.png" alt="corner radius"></p></li><li><p><code>arc.startAngle([angle])</code> 设置扇形的一边的起始角度，作为起始角，单位是弧度。其中在 12 点方向（即 SVG 坐标系统的 -y 方向）为 <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">0</span></span></span></span>。如果入参的是负值表示起始角度在逆时针方向上。</p></li><li><p><code>arc.endAngle([angle])</code> 设置扇形的另一边的起始角度，作为结束角。</p><p>💡 如果 <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">∣</span><span class="mord mathnormal">e</span><span class="mord mathnormal">n</span><span class="mord mathnormal">d</span><span class="mord mathnormal">A</span><span class="mord mathnormal">n</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">e</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">s</span><span class="mord mathnormal">t</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">t</span><span class="mord mathnormal">A</span><span class="mord mathnormal">n</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">e</span><span class="mord">∣</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≥</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.1132em;">τ</span></span></span></span> 则生成一个完整的圆或圆环</p></li><li><p><code>arc.padAngle([angle])</code> 设置扇形的间隔角度</p></li><li><p><code>arc.padRadius([radius])</code> 设置扇形的间隔半径</p><p>💡 间隔角度结合间隔半径算出<strong>间隔弧长</strong> <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">p</span><span class="mord mathnormal">a</span><span class="mord mathnormal">d</span><span class="mord mathnormal">A</span><span class="mord mathnormal">n</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">e</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">p</span><span class="mord mathnormal">a</span><span class="mord mathnormal">d</span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="mord mathnormal">a</span><span class="mord mathnormal">d</span><span class="mord mathnormal">i</span><span class="mord mathnormal">u</span><span class="mord mathnormal">s</span></span></span></span> 对于环形的内外侧都会减去<strong>相同的间隔弧长</strong>，这样就会得到如下方右侧图的效果（两个环形的相邻的边是平行的）；对于扇形或内半径较小的环形和开角较小的环形，只会在外侧减去间隔弧长，这样就得到如下方左侧图的效果（扇形或环形的内侧相连到一点）。但是如果扇形或环形的开角 <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">∣</span><span class="mord mathnormal">e</span><span class="mord mathnormal">n</span><span class="mord mathnormal">d</span><span class="mord mathnormal">A</span><span class="mord mathnormal">n</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">e</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">s</span><span class="mord mathnormal">t</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">t</span><span class="mord mathnormal">A</span><span class="mord mathnormal">n</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">e</span><span class="mord">∣</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≥</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.1132em;">τ</span></span></span></span>（生成一个完整的圆或圆环）则会忽略间隔弧长</p><p><img src="/blog-data/assets/pad-arc.14be58ba.png" alt="pad arc"></p></li><li><p><code>arc.context(parentDOM)</code> 用于设置父容器。如果扇形生成器设置了父容器（一般是选择集，如 <code>&lt;g&gt;</code> 元素），则生成 <code>&lt;path&gt;</code> 元素，并添加到父容器中；如果没有入参，则生成可用于作为 <code>&lt;path&gt;</code> 元素的属性 <code>d</code> 的属性值的字符串</p></li></ul><p>💡 关于饼图或圆环图的<strong>角度</strong>的数据，一般不会「手动」设置，而是通过 <strong>Pies 饼图角度生成器</strong>产生一系列的角度，再将数据用于扇形生成器。</p><h3 id="pies-饼图角度生成器" tabindex="-1"><a class="header-anchor" href="#pies-饼图角度生成器" aria-hidden="true">#</a> Pies 饼图角度生成器</h3><p><mark>使用方法 <code>d3.pie()</code> 创建一个 Pie 饼图角度生成器（以下称为 <code>pie</code>）。</mark></p><p>调用 Pie 饼图角度生成器时，将需要可视化的数据（一个数组）作为入参</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> pie <span class="token operator">=</span> d3<span class="token punctuation">.</span><span class="token function">pie</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> pieArcData <span class="token operator">=</span> <span class="token function">pie</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>

<span class="token comment">// 结果</span>
<span class="token comment">// [</span>
<span class="token comment">//  {&quot;data&quot;:  1, &quot;value&quot;:  1, &quot;index&quot;: 6, &quot;startAngle&quot;: 6.050474740247008, &quot;endAngle&quot;: 6.166830023713296, &quot;padAngle&quot;: 0},</span>
<span class="token comment">//  {&quot;data&quot;:  1, &quot;value&quot;:  1, &quot;index&quot;: 7, &quot;startAngle&quot;: 6.166830023713296, &quot;endAngle&quot;: 6.283185307179584, &quot;padAngle&quot;: 0},</span>
<span class="token comment">//  {&quot;data&quot;:  2, &quot;value&quot;:  2, &quot;index&quot;: 5, &quot;startAngle&quot;: 5.817764173314431, &quot;endAngle&quot;: 6.050474740247008, &quot;padAngle&quot;: 0},</span>
<span class="token comment">//  {&quot;data&quot;:  3, &quot;value&quot;:  3, &quot;index&quot;: 4, &quot;startAngle&quot;: 5.468698322915565, &quot;endAngle&quot;: 5.817764173314431, &quot;padAngle&quot;: 0},</span>
<span class="token comment">//  {&quot;data&quot;:  5, &quot;value&quot;:  5, &quot;index&quot;: 3, &quot;startAngle&quot;: 4.886921905584122, &quot;endAngle&quot;: 5.468698322915565, &quot;padAngle&quot;: 0},</span>
<span class="token comment">//  {&quot;data&quot;:  8, &quot;value&quot;:  8, &quot;index&quot;: 2, &quot;startAngle&quot;: 3.956079637853813, &quot;endAngle&quot;: 4.886921905584122, &quot;padAngle&quot;: 0},</span>
<span class="token comment">//  {&quot;data&quot;: 13, &quot;value&quot;: 13, &quot;index&quot;: 1, &quot;startAngle&quot;: 2.443460952792061, &quot;endAngle&quot;: 3.956079637853813, &quot;padAngle&quot;: 0},</span>
<span class="token comment">//  {&quot;data&quot;: 21, &quot;value&quot;: 21, &quot;index&quot;: 0, &quot;startAngle&quot;: 0.000000000000000, &quot;endAngle&quot;: 2.443460952792061, &quot;padAngle&quot;: 0}</span>
<span class="token comment">// ]</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>然后返回一个数组，它的长度和入参的数组长度一致，元素的次序也一样，<strong>其中每个元素（是一个对象）依次对应一个数据项，并包含以下属性</strong>：</p><ul><li><code>data</code> 数据项的值</li><li><code>value</code> 一个数值，基于该值 Pie 饼图生成器计算该数据项在扇形或环形中应占角度的大小</li><li><code>index</code> 数据项的索引，从 <code>0</code> 开始</li><li><code>starAngle</code> 该数据项在扇形或环形中所对应的起始角</li><li><code>endAngle</code> 该数据项在扇形或环形中所对应的结束角</li><li><code>padAngle</code> 扇形或环形的间隔角度</li></ul><p><mark>然后这些元素就可以作为 Arc 扇形生成器（一般预设了 <code>innerRadius</code> 和 <code>outerRadius</code>，有时候还会预设父容器 <code>context</code>）的入参，然后基于每个元素的 <code>starAngle</code>、<code>endAngle</code> 和 <code>padAngle</code> 生成相应的扇形</mark></p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>pieArcData<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">arc</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// arc 是扇形生成器</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>Pie 饼图角度生成器（以下的 <code>pie</code>）既是一个方法（可以接受数据作为入参），也是一个对象，具有多种方法设置不同的参数，一般这些方法都返回饼图角度生成器本身，便于进行<strong>链式调用</strong>：</p><ul><li><p><code>pie.value([valueMapFunction])</code> 设置每个数据项传递给 Pie 饼图角度生成器的值，默认直接传递整个数据项（因为 D3 假设每一个数据项都是一个数值），即默认的 <code>valueMapFunction</code> 如下</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">value</span><span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> d<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><code>valueMapFunction</code> 接受（每一行）数据项的数据 <code>d</code>、索引 <code>i</code>、整个数据表 <code>data</code> 作为入参，然后可以根据这些数据进行变换，返回代表该数据项的数值，传递给 Pie 饼图角度生成器。</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span><span class="token string">&quot;number&quot;</span><span class="token operator">:</span>  <span class="token number">4</span><span class="token punctuation">,</span> <span class="token string">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Locke&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span><span class="token string">&quot;number&quot;</span><span class="token operator">:</span>  <span class="token number">8</span><span class="token punctuation">,</span> <span class="token string">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Reyes&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span><span class="token string">&quot;number&quot;</span><span class="token operator">:</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token string">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Ford&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span><span class="token string">&quot;number&quot;</span><span class="token operator">:</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token string">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Jarrah&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span><span class="token string">&quot;number&quot;</span><span class="token operator">:</span> <span class="token number">23</span><span class="token punctuation">,</span> <span class="token string">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Shephard&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span><span class="token string">&quot;number&quot;</span><span class="token operator">:</span> <span class="token number">42</span><span class="token punctuation">,</span> <span class="token string">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Kwon&quot;</span><span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> arcs <span class="token operator">=</span> d3<span class="token punctuation">.</span><span class="token function">pie</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    		  <span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token parameter">d</span> <span class="token operator">=&gt;</span> d<span class="token punctuation">.</span>number<span class="token punctuation">)</span> <span class="token comment">// 只需要接受数据项作为入参，将数据项的 number 属性值，作为该数据项传递给 Pie 饼图角度生成器的值</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>💡 <code>valueMapFunction</code> 函数最后返回的值，相当于 Pie 饼图角度生成器所返回的数组中，每个元素的 <code>value</code> 属性。而每个数据项的值，相当于 Pie 饼图角度生成器所返回的数组中，每个元素的 <code>data</code> 属性。</p><p>这里直接将整个数据表传递给 Pie 饼图角度生成器，而不是先进行预处理，是为了在后续的绑定操作中，每个数据项的所有信息都可以绑定到相应的元素上，保留更大的拓展性。但是入参的数据表中（每一行）数据项可能有多个属性（例如以上示例中，每一个数据项都包含 <code>number</code> 和 <code>name</code> 两个属性），而不是单纯的数值，对于这种情况就需要设置 <code>pie.value()</code>，类似于 JS 数组的原始方法 <code>map</code>。</p></li><li><p><code>pie.sort([compareFunction])</code> 设置数据项所对应的角度的优先次序，其中排序方程 <code>compareFunction</code> 和 JS 数组的原始方法 <code>sort</code> 类似，入参是表示<strong>两个需要对比的数据项</strong> <code>a</code> 和 <code>b</code>，如果函数返回一个负值，则 <code>a</code> 排在在 <code>b</code> 前，则；如果函数返回一个正值，则 <code>a</code> 在 <code>b</code> 后。</p><p>💡 实际上 Pie 饼图角度生成器只是对数据项的角度进行「排序」，而不会改变数组中的元素的次序（经过排序后返回的数组的元素次序，和数据表中数据项的顺序是相同的）</p><p>💡 如果设置了 <code>pie.sort()</code> 则隐式地将 <code> pie.sortValues(null)</code> 对比函数设置为 <code>null</code> 忽略按值排序</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">130</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

d3<span class="token punctuation">.</span><span class="token function">pie</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// [</span>
<span class="token comment">//  0: Object {data: 10, index: 6, value: 10, startAngle: 6.094501063720739, endAngle: 6.283185307179585, padAngle: 0}</span>
<span class="token comment">//  1: Object {data: 50, index: 2, value: 50, startAngle: 3.9623691126357747, endAngle: 4.9057903299300065, padAngle: 0}</span>
<span class="token comment">//  2: Object {data: 22, index: 4, value: 22, startAngle: 5.471843060306545, endAngle: 5.886948395916008, padAngle: 0}</span>
<span class="token comment">//  3: Object {data: 80, index: 1, value: 80, startAngle: 2.4528951649650033, endAngle: 3.9623691126357747, padAngle: 0}</span>
<span class="token comment">//  4: Object {data: 11, index: 5, value: 11, startAngle: 5.886948395916008, endAngle: 6.094501063720739, padAngle: 0}</span>
<span class="token comment">//  5: Object {data: 30, index: 3, value: 30, startAngle: 4.9057903299300065, endAngle: 5.471843060306545, padAngle: 0}</span>
<span class="token comment">//  6: Object {data: 130, index: 0, value: 130, startAngle: 0, endAngle: 2.4528951649650033, padAngle: 0}</span>
<span class="token comment">// ]</span>

d3<span class="token punctuation">.</span><span class="token function">pie</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span>b</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> a<span class="token operator">-</span>b <span class="token punctuation">)</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// [</span>
<span class="token comment">//  0: Object {data: 10, index: 0, value: 10, startAngle: 0, endAngle: 0.18868424345884643, padAngle: 0}</span>
<span class="token comment">//  1: Object {data: 50, index: 4, value: 50, startAngle: 1.3773949772495788, endAngle: 2.320816194543811, padAngle: 0}</span>
<span class="token comment">//  2: Object {data: 22, index: 2, value: 22, startAngle: 0.3962369112635775, endAngle: 0.8113422468730396, padAngle: 0}</span>
<span class="token comment">//  3: Object {data: 80, index: 5, value: 80, startAngle: 2.320816194543811, endAngle: 3.8302901422145825, padAngle: 0}</span>
<span class="token comment">// 4: Object {data: 11, index: 1, value: 11, startAngle: 0.18868424345884643, endAngle: 0.3962369112635775, padAngle: 0}</span>
<span class="token comment">//  5: Object {data: 30, index: 3, value: 30, startAngle: 0.8113422468730396, endAngle: 1.3773949772495788, padAngle: 0}</span>
<span class="token comment">//  6: Object {data: 130, index: 6, value: 130, startAngle: 3.8302901422145825, endAngle: 6.283185307179586, padAngle: 0}</span>
<span class="token comment">// ]</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div></li><li><p><code>pie.sortValues([compareFunction])</code> 设置数据项所对应的角度的优先次序，其中排序方程 <code>compareFunction</code> 的入参是表示<strong>两个需要对比的数据项所传递给 Pie 饼图角度生成器的值</strong> <code>valueA</code> 和 <code>valueB</code></p><p>💡 如果设置了 <code>pie.sortValues()</code> 则隐式地将 <code> pie.sort(null)</code> 对比函数设置为 <code>null</code> 忽略按数据项排序</p></li><li><p><code>pie.startAngle([angle])</code> 设置 Pie 饼图角度生成器的起始角度（默认值是 <code>0</code>），它会被调用一次，用于设置第一个扇区的开始角度</p><p>💡 入参 <code>angle</code> 虽然可以是任意单位，但是如果打算将 Pie 饼图角度生成器的结果应用于 Arc 扇形生成器中，应该使用弧度作为单位，例如 <code>angle=Math.PI/2</code></p></li><li><p><code>pie.endAngle([angle])</code> 置 Pie 饼图角度生成器的起始角度（默认值是 <code>2*Math.PI</code>），它会被调用一次，用于设置最后一个扇区的结束角度</p></li><li><p><code>pie.padAngle([angle])</code> 设置相邻扇形之间的间隔角度，则在生成扇形时会预留出相应的角度空间（间隔角度与数据项的数量的乘积，最大值是 <code>|endAngle-startAngle|</code>）用于间隔，余下的角度空间再按比例分配给各个数据项。</p></li></ul><h2 id="线段生成器-lines" tabindex="-1"><a class="header-anchor" href="#线段生成器-lines" aria-hidden="true">#</a> 线段生成器 Lines</h2><p>线段生成器 Lines 基于给定的坐标点生成线段（或曲线），常用于构成一些可视化图形，如折线图 line chart 或分层的边缘捆绑图 hierarchical edge bundling。</p><p><mark>使用方法 <code>d3.line([xFunc], [yFunc])</code> 创建一个线段生成器（以下称为 <code>line</code>）。</mark></p><p>它既是一个方法，可以直接调用，<strong>传递</strong>需要可视化的数据（一个数组）作为入参（实际这些参数在内部被相应的方法调用，例如在创建线段生成器时，传递横坐标和纵坐标的读取函数 <code>xFunc</code> 和 <code>yFunc</code> 作为入参，然后数组每一个元素都会调用这两个函数，来获取相应的坐标值），来创建线段。</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 创建一个默认的线段生成器</span>
<span class="token keyword">const</span> line <span class="token operator">=</span> d3<span class="token punctuation">.</span><span class="token function">line</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">line</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">40</span><span class="token punctuation">,</span> <span class="token number">90</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;M10,60L40,90&quot;</span>

<span class="token comment">// 创建一个线段生成器，并设置了相应的参数</span>
cosnt line <span class="token operator">=</span> d3<span class="token punctuation">.</span><span class="token function">line</span><span class="token punctuation">(</span>
    <span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> d<span class="token punctuation">.</span>xValue<span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> d<span class="token punctuation">.</span>yValue
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> lineData <span class="token operator">=</span> <span class="token function">line</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    xValue<span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span> 
    yValue<span class="token operator">:</span> <span class="token number">60</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    xValue<span class="token operator">:</span> <span class="token number">40</span><span class="token punctuation">,</span> 
    yValue<span class="token operator">:</span> <span class="token number">90</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;M10,60L40,90&quot;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p>💡 调用线段生成器时返回的结果，同样会基于生成器是否设置了<strong>父容器 context</strong> 而不同。如果设置了父容器，则生成 <code>&lt;path&gt;</code> 元素，并添加到父容器中；如果没有则生成字符串。</p><p>💡 如果数据点较多，在绘制折线图时，可以将元素 <code>&lt;path&gt;</code> <strong>属性 <code>stroke-miterlimit</code> 设置为 <code>1</code></strong>，以避免折线「锋利」交接处过渡延伸，导致该点的数据偏移</p><p>它也是一个对象，具有多种方法设置不同的参数，一般通过<strong>链式调用</strong>的方式来使用。例如使用默认参数创建一个线段生成器 <code>const line = d3.line()</code>，然后在之后再调用相应的方法进行设置：</p><ul><li><p><code>line.x(xFunc)</code> 设置横坐标读取函数，该函数会在调用线段生成器时，<strong>为数组中的每一个元素都执行一次</strong>，以返回该数据所对应的横坐标。</p><p>该函数有三个入参（线段生成器的其他方法的入参函数一般都是有这三个入参）：当前的元素 <code>d</code>，该元素在数组中的索引 <code>i</code>，整个数组 <code>data</code>。通过这些入参数据，一般利用<strong>比例尺</strong>进行映射，返回相应的横坐标的值。</p><p>D3 默认在使用线段生成器时，传递进来的数组的格式如 <code>[[10, 60], [40, 90]]</code>，即每个元素都是由两个数值构成的数组，因此它的默认横坐标读取函数如下</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">x</span><span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> d<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>💡 如果数组中的元素并不是上述的默认结构，而是其他更复杂的结构，或者数据并不是坐标值，都需要配置 <code>linx.x(xFunc)</code> 横坐标读取函数</p></li><li><p><code>line.y(xFunc)</code> 设置纵坐标读取函数，设置方式和横坐标读取函数一样。</p></li><li><p><code>line.defined(definedState)</code> 设置数据完整性检验函数，该函数会在调用线段生成器时，<strong>为数组中的每一个元素都执行一次</strong>，返回布尔值，以判断该元素的数据是否完整。</p><p>该函数也是有三个入参，当函数返回 <code>true</code> 时，线段线段生成器就会执行下一步（调用坐标读取函数），最后生成该元素相应的坐标数据；当函数返回 <code>false</code> 时，该元素就会就会跳过，当前线段就会截至，并在下一个有定义的元素再开始绘制，反映在图上就是一段段<a href="http://bl.ocks.org/mbostock/0533f44f2cfabecc5e3a" target="_blank" rel="noopener noreferrer">分离的线段</a>。</p><p>💡 如果两侧的元素完整性欠缺，导致产生「孤立」的点，一般这些点在页面上不会显示出来，除非元素 <code>&lt;path&gt;</code> 的属性 <code>stroke-linecap</code> 路径两端的形状设置为 <code>round</code> 或 <code>square</code>（默认值是 <code>butt</code>）</p></li><li><p><code>line.curve(curveInterpolator)</code> 设置两点之间的曲线插值器</p></li><li><p><code>line.context(parentDOM)</code> 用于设置父容器。在使用线段生成器时，如果设置了父容器，就会生成 <code>&lt;path&gt;</code> 元素，并添加到父容器中；如果没有设置父容器，则生成可用于作为 <code>&lt;path&gt;</code> 元素的属性 <code>d</code> 的属性值的字符串</p></li></ul><h3 id="径向线段生成器" tabindex="-1"><a class="header-anchor" href="#径向线段生成器" aria-hidden="true">#</a> 径向线段生成器</h3><p>径向线段生成器和上述的线段生成器类似，也是用来生成线段或曲线，不同的是它的笛卡尔坐标系的横坐标换成角度（弧度为单位），纵坐标换成距离圆心的长度。</p><p><mark>使用方法 <code>d3.lineRadial()</code> 创建一个线段生成器（以下称为 <code>lineRadial</code>）。</mark></p><p>💡 调用径向线段生成器时，它生成的线段的中心坐标默认是 <code>(0, 0)</code>，可以为其父容器（一般是元素 <code>&lt;g&gt;</code>）设置 <code>transform</code> 属性，移动到目标位置</p><p>它也具有多种方法设置不同的参数：</p><ul><li><p><code>lineRadial.angle(angleFunc)</code> 类似于 <code>line.x(xFunc)</code>，设置角度读取函数，返回的角度单位是弧度。</p></li><li><p><code>lineRadial.radius(radiusFunc)</code> 类似于 <code>line.y(xFunc)</code>，设置径向距离读取函数</p></li><li><p><code>lineRadial.defined(definedState)</code></p></li><li><p><code>lineRadial.curve(curveInterpolator)</code> 其中 <a href="https://github.com/d3/d3-shape#curveMonotoneX" target="_blank" rel="noopener noreferrer">curveMonotoneX</a> 和 <a href="https://github.com/d3/d3-shape#curveMonotoneY" target="_blank" rel="noopener noreferrer">curveMonotoneY</a> 单调性曲线插值器不适用</p></li><li><p><code>lineRadial.context(parentDOM)</code></p></li></ul><h2 id="面积生成器-areas" tabindex="-1"><a class="header-anchor" href="#面积生成器-areas" aria-hidden="true">#</a> 面积生成器 Areas</h2><p>面积生成器 Areas 和线段生成器类似，也是基于给定的坐标点生成线段（或曲线），不同的是它生成<strong>两条边界线</strong>：</p><ul><li>上边界线 topline <code>y1</code></li><li>下边界线 baseline <code>y0</code> 一般下边界线设置为常量 <code>y0=0</code></li></ul><p>一般两条线段的横坐标相同 <code>x0=x1</code>，而纵坐标不同，两条边界线之间区域就是目标面积</p><p><mark>使用方法 <code>d3.area([xFunc], [y0Func], [y1Func])</code> 创建一个面积生成器（以下称为 <code>area</code>）。</mark></p><p>它既是一个方法，可以直接调用，<strong>传递</strong>需要可视化的数据（一个数组）作为入参（实际这些参数在内部被相应的方法调用，例如在创建面积生成器时，传递横坐标读取函数 <code>xFunc</code> 以及上边界线和下边界线纵坐标的读取函数 <code>y0Func</code> 和 <code>y1Func</code> 作为入参；然后在调用面积生成器时，数组每一个元素都会调用这三个函数，来获取相应的坐标值），来创建面积。</p><p>它也是一个对象，具有多种方法设置不同的参数，一般通过<strong>链式调用</strong>的方式来使用：</p><ul><li><p><code>area.x(xFunc)</code> 和 <code>area.x0(xFunc)</code> 一样，用于设置下边界线横坐标读取函数</p></li><li><p><code>area.x0(xFunc)</code> 设置下边界线横坐标读取函数，该函数会在调用线段生成器时，<strong>为数组中的每一个元素都执行一次</strong>，以返回该数据所对应的横坐标。</p><p>该函数也是有三个入参（面积生成器的其他方法的入参函数一般都是有这三个入参）：当前的元素 <code>d</code>，该元素在数组中的索引 <code>i</code>，整个数组 <code>data</code>。通过这些入参数据，一般利用<strong>比例尺</strong>进行映射，返回相应的横坐标的值。</p><p>D3 默认在使用线段生成器时，传递进来的数组的格式如 <code>[[10, 60], [40, 90]]</code>，即每个元素都是<strong>由两个数值</strong>构成的数组，因此它的默认横坐标读取函数如下</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">x</span><span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> d<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>💡 如果数组中的元素并不是上述的默认结构，而是其他更复杂的结构，或者数据并不是坐标值，都需要配置横坐标读取函数</p></li><li><p><code>area.x1(xFunc)</code> 设置上边界线横坐标读取函数。默认复用相应的 <code>x0</code> 值作为 <code>x1</code> 的值，一般都不需要进行配置。</p></li><li><p><code>area.y(yFunc)</code> 和 <code>area.y0(yFunc)</code> 一样，用于设置下边界线纵坐标读取函数</p></li><li><p><code>area.y0(yFunc)</code> 设置下边界线纵坐标读取函数，它的默认值是 <code>0</code>，即页面上默认的下边界线是横坐标，这也是常见的面积图设定，可以不进行设置而使用默认值；但如果下边界线也是折线，则需要配置下边界线纵坐标读取函数</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">y</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li><li><p><code>area.y1(yFunc)</code> 设置上边界线纵坐标读取函数，</p><p>D3 默认在使用线段生成器时，传递进来的数组的格式如 <code>[[10, 60], [40, 90]]</code>，即每个元素都是<strong>由两个数值</strong>构成的数组，下边界线纵坐标读取函数的默认纵坐标读取函数如下</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">y</span><span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token keyword">return</span> d<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li><li><p><code>area.defined(definedState)</code> 设置数据完整性检验函数，其作用和线段生成器的相应方法一样，如果存在不完整的数据，也是会生成<a href="https://bl.ocks.org/mbostock/3035090" target="_blank" rel="noopener noreferrer">分离的多块面积</a>。</p></li><li><p><code>area.curve(curveInterpolator)</code> 设置两点之间的曲线插值器</p></li><li><p><code>area.context(parentDOM)</code> 用于设置父容器</p></li><li><p><code>area.lineX0()</code> 和 <code>area.lineY0()</code> 都是返回下边界线生成器，一般用于在页面生成面积的下边界线，进行强调显示</p></li><li><p><code>area.lineX1()</code> 返回上边界线的生成器</p></li><li><p><code>area.lineY1()</code> 返回一个线段生成器，它的横坐标读取函数返回的是 <code>x0</code>，而纵坐标读取函数返回的是 <code>y1</code></p></li></ul><h3 id="径向面积生成器" tabindex="-1"><a class="header-anchor" href="#径向面积生成器" aria-hidden="true">#</a> 径向面积生成器</h3><p>径向面积生成器和上述的面积生成器类似，不同的是它的笛卡尔坐标系的横坐标换成角度（弧度为单位），纵坐标换成距离圆心的长度，上边界线对应于外径 outerRadius，下边界线对应于内径 innerRadius。</p><p><mark>使用方法 <code>d3.areaRadial()</code> 创建一个线段生成器（以下称为 <code>areaRadial</code>）。</mark></p><p>💡 调用径向面积生成器时，它生成的线段的中心坐标默认是 <code>(0, 0)</code>，可以为其父容器（一般是元素 <code>&lt;g&gt;</code>）设置 <code>transform</code> 属性，移动到目标位置</p><p>它也具有多种方法设置不同的参数：</p><ul><li><p><code>areaRadial.angle(angleFunc)</code> 类似于 <code>area.x(xFunc)</code>，设置角度读取函数，返回的角度单位是弧度。</p><p>💡 也有分别设置内径角度读取函数 <code>areaRadial.startAngle(angleFunc)</code> 和外径角度读取函数 <code>areaRadial.endAngle(angleFunc)</code> 的方法，<strong>不过一般都不需要分开设置</strong>。</p></li><li><p><code>areaRadial.radius(radiusFunc)</code> 类似于 <code>area.y(xFunc)</code>，设置内径距离读取函数</p><p>💡 相应地有分别设置内径距离读取函数 <code>areaRadial.innerRadius(radiusFunc)</code> 和外径距离读取函数 <code>areaRadial.outerRadius(radiusFunc)</code></p></li><li><p><code>areaRadial.defined(definedState)</code></p></li><li><p><code>areaRadial.curve(curveInterpolator)</code> 其中 <a href="https://github.com/d3/d3-shape#curveMonotoneX" target="_blank" rel="noopener noreferrer">curveMonotoneX</a> 和 <a href="https://github.com/d3/d3-shape#curveMonotoneY" target="_blank" rel="noopener noreferrer">curveMonotoneY</a> 单调性曲线插值器不适用</p></li><li><p><code>areaRadial.context(parentDOM)</code></p></li><li><p><code>areaRadial.lineStartAngle()</code> 和 <code>areaRadial.lineInnerRadius()</code> 返回内径线段生成器</p></li><li><p><code>areaRadial.lineEndAngle()</code> 返回外径线段生成器</p></li><li><p><code>areaRadial.lineOuterRadius()</code> 返回一个线段生成器，它的角度读取函数返回的是内径角度 startAngle，径向距离读取函数返回的是外径距离 outerRadius</p></li></ul><h3 id="堆叠生成器-stacks" tabindex="-1"><a class="header-anchor" href="#堆叠生成器-stacks" aria-hidden="true">#</a> 堆叠生成器 Stacks</h3><p>堆叠条形图、河流图（分别是条形图和面积图的一种变形）是一类适合同时对多个系列的数据进行对比的图表。D3 提供了堆叠生成器 Stacks，该生成器并<strong>不能</strong>直接生成形状，而是将原始数据转换为便于生成这类型图表的数据，一般将堆叠生成器与面积生成器配合使用（用于生成河流图，也可以直接使用，手动生成条形图）。</p><p><mark>使用方法 <code>d3.stack()</code> 创建一个堆叠生成器（以下称为 <code>stack</code>）</mark></p><p>它既是一个方法，可以直接调用，<strong>传递</strong>需要可视化的数据。默认传递的数据格式是一个数组，其中每个元素都是一个对象，它包含了多个系列数据（属性名是系列名，属性值是当前记录中该系列对应的具体数据）</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 原始数据样例</span>
<span class="token comment">// 数组每个元素都是一条数据记录，它包含了多个系列的数据（不同类型的水果在当月的销量）</span>
<span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span>month<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token number">2015</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> apples<span class="token operator">:</span> <span class="token number">3840</span><span class="token punctuation">,</span> bananas<span class="token operator">:</span> <span class="token number">1920</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>month<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token number">2015</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> apples<span class="token operator">:</span> <span class="token number">1600</span><span class="token punctuation">,</span> bananas<span class="token operator">:</span> <span class="token number">1440</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>它也是一个对象，具有多种方法设置不同的参数，一般通过<strong>链式调用</strong>的方式来使用，其中必须配置的参数是系列的名称（默认是一个空数组，则不会对数据进行转换生成相应的系列数据）</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> stack <span class="token operator">=</span> d3<span class="token punctuation">.</span><span class="token function">stack</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&quot;apples&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;bananas&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>然后在调用堆叠生成器时，会对原始数据进行转换，在返回的结果中为每一个系列生成一个数组</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> series <span class="token operator">=</span> <span class="token function">stack</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 返回的结果，转换后得到各系列的数据</span>
<span class="token punctuation">[</span>
  <span class="token comment">// 每一个系列的数据都独立「抽取」出来组成一个数组</span>
  <span class="token comment">// apple 系列数据</span>
  <span class="token punctuation">[</span>
    <span class="token comment">// 每个元素都是 apple 的月销量数据点</span>
    <span class="token comment">// 前两个数值类似于面积图中的下边界线和上边界线</span>
    <span class="token comment">// data 对象保留了转换前该数据点对应的原始数据来源</span>
    <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">3840</span><span class="token punctuation">,</span> data<span class="token operator">:</span> <span class="token punctuation">{</span>month<span class="token operator">:</span> <span class="token number">2014</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">31</span>T16<span class="token operator">:</span><span class="token number">00</span>Z<span class="token punctuation">,</span> apples<span class="token operator">:</span> <span class="token number">3840</span><span class="token punctuation">,</span> bananas<span class="token operator">:</span> <span class="token number">1920</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// 12 月销量</span>
    <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1600</span><span class="token punctuation">,</span> data<span class="token operator">:</span> <span class="token punctuation">{</span>month<span class="token operator">:</span> <span class="token number">2015</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">31</span>T16<span class="token operator">:</span><span class="token number">00</span>Z<span class="token punctuation">,</span> apples<span class="token operator">:</span> <span class="token number">1600</span><span class="token punctuation">,</span> bananas<span class="token operator">:</span> <span class="token number">1440</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// 1 月销量</span>
    key<span class="token operator">:</span> <span class="token string">&quot;apples&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 该系列对应的 key（名称）</span>
    index<span class="token operator">:</span> <span class="token number">0</span> <span class="token comment">// 该系列在 series 中的顺序（即对应于堆叠条形图中该系列叠放的次序）</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token comment">// bananas 系列数据</span>
  <span class="token punctuation">[</span>
    <span class="token punctuation">[</span><span class="token number">3840</span><span class="token punctuation">,</span> <span class="token number">5760</span><span class="token punctuation">,</span> data<span class="token operator">:</span> <span class="token punctuation">{</span>month<span class="token operator">:</span> <span class="token number">2014</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">31</span>T16<span class="token operator">:</span><span class="token number">00</span>Z<span class="token punctuation">,</span> apples<span class="token operator">:</span> <span class="token number">3840</span><span class="token punctuation">,</span> bananas<span class="token operator">:</span> <span class="token number">1920</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token number">1600</span><span class="token punctuation">,</span> <span class="token number">3040</span><span class="token punctuation">,</span> data<span class="token operator">:</span> <span class="token punctuation">{</span>month<span class="token operator">:</span> <span class="token number">2015</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">31</span>T16<span class="token operator">:</span><span class="token number">00</span>Z<span class="token punctuation">,</span> apples<span class="token operator">:</span> <span class="token number">1600</span><span class="token punctuation">,</span> bananas<span class="token operator">:</span> <span class="token number">1440</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    key<span class="token operator">:</span> <span class="token string">&quot;bananas&quot;</span><span class="token punctuation">,</span>
    index<span class="token operator">:</span> <span class="token number">1</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">]</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p>💡 从以上简单的样例可以知道，堆叠生成器的实际作用是<strong>对原始数据进行转换</strong>：基于系列的次序，通过<strong>累加</strong>的方式，从原始的数据得到**「堆叠」形式的数据**（如果原始的数据不是坐标等图形变量，转换得到的数据也不能直接用于「绘图」，可能还需要在传递给面积生成器时，借助合适的比例尺进行转换映射处理），并按照系列返回结果</p><p>堆叠生成器提供多种方法以设置不同的参数：</p><ul><li><p><code>stack.keys([keys])</code> 设置系列的名称，传递一个数组 <code>keys</code> 或一个返回数组 <code>keys</code> 的函数。一般数组元素的数据类型是字符串，但也可以是其他数据类型。</p></li><li><p><code>stack.value(valueFunc)</code> 设置各系列的数据读取函数。在调用堆叠生成器对原始数据进行转换过程中，每一个原始数据 <code>d</code> 和系列名称 <code>key</code>（这是在 <code>stack.keys([keys])</code> 设定的数组中的元素）会作为入参，分别调用该函数，以此获取相应系列的数据，因此该默认读取函数如下</p></li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">value</span><span class="token punctuation">(</span><span class="token parameter">d<span class="token punctuation">,</span> key</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> d<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>如果原始数据中系列的名称，和设置的系列名称 <code>key</code> 不同；或原始数据的格式和默认格式不同（D3 默认原始数据中数组的每个元素都是一条数据记录（一个对象），它包含多个属性，而属性名就是系列的名称，属性值就是该系列在当前记录中的具体值），则需要手动设置数据读取函数。</p><ul><li><p><code>stack.order(orderFunc)</code> 设置系列堆叠排序函数，<strong>即对应于堆叠条形图中该系列叠放的次序</strong>。该函数的入参是系列数据 <code>series</code>（原始数据先按照系列名称数组 <code>keys</code> 进行预排序生成了系列数据），返回的是一个数组，数据的元素是一个表示索引的数值，依次对应于系列名称数组 <code>keys</code> 中各系列的排序优先次序。</p><p>默认使用 <code>stack.order(d3.stackOrderNone)</code> 排序方式，即按照系列名称数组来排序，该排序函数<a href="https://github.com/d3/d3-shape/blob/main/src/order/none.js" target="_blank" rel="noopener noreferrer">源码</a>如下</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">orderNone</span><span class="token punctuation">(</span><span class="token parameter">series</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> n <span class="token operator">=</span> series<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
  <span class="token keyword">const</span> o <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">--</span>n <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> o<span class="token punctuation">[</span>n<span class="token punctuation">]</span> <span class="token operator">=</span> n<span class="token punctuation">;</span>
  <span class="token keyword">return</span> o<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>D3 还提供了多种<a href="https://github.com/d3/d3-shape#stack-orders" target="_blank" rel="noopener noreferrer">排序函数</a>：</p><ul><li><code>d3.stackOrderAppearance</code> 在所有数据点中，具有最大值的系列在底部</li><li><code>d3.stackOrderAscending</code> 系列所有值之和最小的在底部</li><li><code>d3.stackOrderDescending</code> 系列所有值之和最大的在底部</li><li><code>d3.stackOrderInsideOut</code> 在所有数据点中，具有最大值的系列在中间（一般用于<a href="http://leebyron.com/streamgraph/" target="_blank" rel="noopener noreferrer">河流图</a>中）</li><li><code>d3.stackOrderNone</code> 默认值，堆叠次序按照系列名称数组 <code>keys</code> 的顺序</li><li><code>d3.stackOrderReverse</code> 堆叠次序和系列名称数组 <code>keys</code> 次序相反</li></ul><p>如果内置的排序函数不能满足要求，也可以自定义排序函数</p><p>💡 运行完排序函数，系列数据 <code>series</code> 中各元素（也是一个数组，也是一个对象）就具有 <code>index</code> 属性。排序函数在基线函数之前运行，因此在执行完排序函数时，各系列数据的基线还是默认值零。</p></li><li><p><code>stack.offset(offsetFunc)</code> 设置系列堆叠基线函数。该函数的入参是系列数据 <code>series</code> 和排序数组 <code>order</code></p><p>默认使用 <code>stack.offset(d3.stackOffsetNone)</code> 即以零为基线。</p><p>D3 还提供了多种<a href="https://github.com/d3/d3-shape#stack-offsets" target="_blank" rel="noopener noreferrer">基线函数</a>：</p><ul><li><code>d3.stackOffsetExpand</code> 对数据进行标准化，基线是零，上边界线是 1</li><li><code>d3.stackOffsetDiverging</code> 允许正值和负值分别进行堆叠，正值会在零之上进行堆叠，负值会在零之下堆叠</li><li><code>d3.stackOffsetNone</code> 默认值，以零为基线</li><li><code>d3.stackOffsetSilhouette</code> 将基线向下移动，使河流图的中心始终为零</li><li><code>d3.stackOffsetWiggle</code> 移动基线，以最大程度地减少各系列在横轴方向上的「摆动」，一般用在<a href="http://leebyron.com/streamgraph/" target="_blank" rel="noopener noreferrer">河流图</a>中，与 <code>d3.stackOrderInsideOut</code> 排序函数配合使用。</li></ul><p>如果内置的基线函数不能满足要求，也可以自定义基线函数</p></li></ul><h2 id="曲线插值生成器-curves" tabindex="-1"><a class="header-anchor" href="#曲线插值生成器-curves" aria-hidden="true">#</a> 曲线插值生成器 Curves</h2><p><strong>曲线插值生成器并不能直接生成形状，而是定义了两个离散点之间的连线如何生成</strong>，D3 提供了多种不同的<a href="https://github.com/d3/d3-shape#curves" target="_blank" rel="noopener noreferrer">曲线插值生成器</a>，对应于不同的连线方式，它们的作用一般都是基于离散的数据点模拟出顺滑的曲线。</p><p><strong>它要与线段生成器或面积生成器配合使用</strong>，一般是作为线段生成器的方法 <code>line.curve()</code> 或面积生成器的方法 <code>area.curve()</code> 的入参。</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> line <span class="token operator">=</span> d3<span class="token punctuation">.</span><span class="token function">line</span><span class="token punctuation">(</span><span class="token parameter">d</span> <span class="token operator">=&gt;</span> d<span class="token punctuation">.</span>date<span class="token punctuation">,</span> <span class="token parameter">d</span> <span class="token operator">=&gt;</span> d<span class="token punctuation">.</span>value<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">curve</span><span class="token punctuation">(</span>d3<span class="token punctuation">.</span>curveCatmullRom<span class="token punctuation">.</span><span class="token function">alpha</span><span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>💡 默认使用 <code>d3.curveLinear</code> 曲线插值生成器，即两个相邻的离散点之间以直连的方式生成线段。</p><p>D3 提供了多种不同的曲线插值生成器，它们可进行的参数配置也不同，具体的效果可以参考<a href="https://github.com/d3/d3-shape#curves" target="_blank" rel="noopener noreferrer">官方文档</a>：</p><ul><li><p><code>d3.curveBasis(context)</code></p></li><li><p><code>d3.curveBasisClosed(context)</code></p></li><li><p><code>d3.curveBasisOpen(context)</code></p></li><li><p><code>d3.curveBasisOpen(context)</code></p></li><li><p><code>d3.curveBumpX(context)</code></p></li><li><p><code>d3.curveBumpY(context)</code></p></li><li><p><code>d3.curveBundle(context)</code> 常用于分层的边缘捆绑图 hierarchical edge bundling，只与线段生成器配合使用。该曲线插值生成器 <code>bundle</code> 可以设置 <code>beta</code> 系数 <code>bundle.beta(bataValue)</code>，默认值是 <code>0.85</code></p></li><li><p><code>d3.curveCardinal(context)</code></p></li><li><p><code>d3.curveCardinalClosed(context)</code></p></li><li><p><code>d3.curveCardinalOpen(context)</code></p><p>以上三种曲线插值生成器 <code>cardinal</code> 可以设置张力 <code>tension</code> 系数 <code>cardinal.tension(tensionValue)</code>，范围是 <code>[1, 0]</code></p></li><li><p><code>d3.curveCatmullRom(context)</code></p></li><li><p><code>d3.curveCatmullRomClosed(context)</code></p></li><li><p><code>d3.curveCatmullRomOpen(context)</code></p><p>以上三种曲线插值生成器 <code>catmullRom</code> 可以设置 <code>alpha</code> 系数 <code>catmullRom.alpha(alpha)</code>，范围是 <code>[1, 0]</code></p></li><li><p><code>d3.curveLinear(context)</code></p></li><li><p><code>d3.curveLinearClosed(context)</code></p></li><li><p><code>d3.curveMonotoneX(context)</code></p></li><li><p><code>d3.curveMonotoneY(context)</code></p></li><li><p><code>d3.curveNatural(context)</code></p></li><li><p><code>d3.curveStep(context)</code></p></li><li><p><code>d3.curveStepAfter(context)</code></p></li><li><p><code>d3.curveStepBefore(context)</code></p></li></ul><p>💡 可以使用 D3 提供的相关接口，<a href="https://github.com/d3/d3-shape#custom-curves" target="_blank" rel="noopener noreferrer">自定义曲线插值生成器</a>。</p><h2 id="连线生成器-links" tabindex="-1"><a class="header-anchor" href="#连线生成器-links" aria-hidden="true">#</a> 连线生成器 Links</h2><p>连线生成器 Links 基于两个坐标点，绘制出平滑的三次贝塞尔曲线作为两点之间（从起源点 source point 到目标点 target point）的连线，一般用于树形图 tree diagram 中。</p><p>所绘制的连线在起点和终点的处的<strong>切线可以有三种形式</strong>，分别通过三种不同的方法创建三种不同的连线生成器（以下称为 <code>link</code>），适用于不同方向的树形图中</p><ul><li><mark>使用方法 <code>d3.linkVertical()</code> 创建（生成垂直切线的）连线生成器（以下称为 <code>linkVertical</code>）</mark>，一般用于父节点和子节点是上下相对位置的树形图中</li><li><mark>使用方法 <code>d3.linkHorizontal()</code> 创建（生成<a href="https://observablehq.com/@d3/tree" target="_blank" rel="noopener noreferrer">水平切线</a>的）连线生成器（以下称为 <code>linkHorizontal</code>）</mark>，一般用于父节点和子节点是水平左右相对位置的树形图中</li><li><mark>使用方法 <code>d3.linkRadial()</code> 创建（生成<a href="https://observablehq.com/@d3/radial-tidy-tree" target="_blank" rel="noopener noreferrer">径向切线</a>的）连线生成器（以下称为 <code>linkRadial</code>）</mark>，一般用于根节点在内部，后代节点在外部的环形树形图中</li></ul><p>它既是一个方法，可以直接调用，<strong>传递</strong>需要可视化的数据，连线生成器会根据数据构建出连线。一般是以一个对象作为入参，它最基本的形式是包含 <code>source</code> 和 <code>target</code> 这两个属性，分别表示连线的起点和终点，这两个属性的属性值最基本的形式就是一个数组，分别表示起点或终点的 <code>x</code> 和 <code>y</code> 值</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// D3 默认支持的连线生成器入参数据形式</span>
<span class="token function">link</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  source<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  target<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">300</span><span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>💡 调用连线生成器时返回的结果，也会基于生成器是否设置了<strong>父容器 context</strong> 而不同。如果设置了父容器，则生成 <code>&lt;path&gt;</code> 元素，并添加到父容器中；如果没有设置父容器，则生成字符串。</p><p>它也是一个对象，具有多种方法设置不同的参数，一般通过<strong>链式调用</strong>的方式来使用：</p><p>对于 <code>linkVertical</code> 和 <code>linkHorizontal</code> 连线生成器有以下方法</p><ul><li><p><code>link.source(sourceFunc)</code> 设置起始点读取函数。该函数的入参是调用连线生成器时传递的数据 <code>d</code>，D3 默认该数据是一个对象，且具有 <code>source</code> 属性表示起始点，因此默认读取函数如下</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">source</span><span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> d<span class="token punctuation">.</span>source<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>💡 如果入参的数据形式和 D3 的默认形式不同，需要手动设置起始点读取函数，返回起始点</p></li><li><p><code>link.target(targetFunc)</code> 设置起始点读取函数。默认读取函数如下</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">target</span><span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> d<span class="token punctuation">.</span>target<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li><li><p><code>link.x(xFunc)</code> 设置横坐标读取函数。D3 默认起点和终点都是一个含有两个元素的数组，第一个元素表示这些点的横坐标，第二个元素表示这些点的纵坐标，因此默认读取函数如下</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">x</span><span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> d<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>💡 如果入参的数据形式和 D3 的默认形式不同，需要手动设置点读取函数，返回横坐标</p></li><li><p><code>link.y(yFunc)</code> 设置纵坐标读取函数。默认读取函数如下</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">y</span><span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> d<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li><li><p><code>link.context(parentDOM)</code> 用于设置父容器</p></li></ul><p>对于 <code>linkRadial</code> 连线生成器有类似的方法，不过它的横坐标变成角度（单位是弧度），纵坐标变成了径向距离</p><ul><li><p><code>linkRadial.angle(angleFunc)</code> 类似于 <code>link.x(xFunc)</code>，设置角度读取函数，返回的角度单位是弧度</p></li><li><p><code>linkRadial.radius(radiusFunc)</code> 类似于 <code>link.y(yFunc)</code>，设置径向距离读取函数</p><p>💡 调用径向连线生成器时，它生成的连线的中心坐标默认是 <code>(0, 0)</code>，可以为其父容器（一般是元素 <code>&lt;g&gt;</code>）设置 <code>transform</code> 属性，移动到目标位置</p></li></ul><p>💡 如果希望从抽象的数据开始以构建树形图，可以使用 <a href="https://github.com/d3/d3-hierarchy" target="_blank" rel="noopener noreferrer">d3-hierarchy</a> 模块。该模块基于抽象的数据和页面大小自动计算布局，即将抽象的数据映射到页面的可视化图形元素，生成各连线的起点 <code>source</code> 和终点 <code>target</code> 坐标数据。再将这些数据分别传递给相应的连线生成器即可分别生成连线。</p><h2 id="符号生成器-symbols" tabindex="-1"><a class="header-anchor" href="#符号生成器-symbols" aria-hidden="true">#</a> 符号生成器 Symbols</h2><p>符号生成器 Symbols 提供了一系列常用的符号，一般在散点图中表示数据点，以区分不同的数据类别。</p><p><img src="/blog-data/assets/default-symbols.53392dbb.png" alt="内置符号"></p><p>D3 内置了 7 种符号：</p><ul><li><code>d3.symbolCircle</code> 圆形</li><li><code>d3.symbolCross</code> 十字形</li><li><code>d3.symbolDiamond</code> 菱形</li><li><code>d3.symbolSquare</code> 正方形</li><li><code>d3.symbolStar</code> 星形</li><li><code>d3.symbolTriangle</code>（向上的）三角形</li><li><code>d3.symbolWye</code> Y 形</li></ul><p>💡 可以通过 <code>d3.symbols</code> 获取<strong>具有这 7 种内置符号类型的数组</strong>，可用于创建排序比例尺 Ordinal Scales。</p><p><mark>使用方法 <code>d3.symbol([type][, size])</code> 创建符号生成器（以下称为 <code>symbol</code>）</mark></p><p>创建符号生成器时，第一个（可选）参数设置符号的类型，可以是 7 种内置符号类型之一，也可以是自定义的符号类型；第二个（可选）参数设置符号的尺寸（单位是像素）；如果没有入参，则调用符号生成器时就会默认创建宽和高都为 64 px 的圆形符号。</p><p>它既是一个方法，可以直接调用，生成相应的符号。</p><p>它也是一个对象，具有多种方法设置不同的参数，一般通过<strong>链式调用</strong>的方式来使用：</p><ul><li><p><code>symbol.type([type])</code> 设置符号类型，可以是 7 种内置符号类型之一，也可以是自定义的符号类型。默认值是圆形，其入参是函数如下：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">type</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> circle<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li><li><p><code>symbol.size([size])</code> 设置符号的尺寸（宽和高都一样），单位是像素，这对于同时希望使用符号类型和符号大小两个视觉通道变量来编码数据是十分有用的。默认值是如下</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token number">64</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li><li><p><code>symbol.context(parentDOM)</code> 设置父容器。在使用符号生成器时，如果设置了父容器，就会生成 <code>&lt;path&gt;</code> 元素，并添加到父容器中；如果没有设置父容器，则生成可用于作为 <code>&lt;path&gt;</code> 元素的属性 <code>d</code> 的属性值的字符串</p></li></ul><p>💡 可以使用 D3 提供的相关接口，<a href="https://github.com/d3/d3-shape#custom-symbol-types" target="_blank" rel="noopener noreferrer">自定义符号类型</a>。它是一个具有方法 <code>draw</code> 的对象，而该方法接收两个入参 <code>context</code> 和 <code>size</code>，其中 <code>context</code> 是一个可以调用 canvas API 中与 <a href="https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D#paths" target="_blank" rel="noopener noreferrer">path 相关方法</a>的对象；而 <code>size</code> 则用于设置符号的大小。可以参考 7 种 D3 内置符号的<a href="https://github.com/d3/d3-shape/tree/main/src/symbol" target="_blank" rel="noopener noreferrer">源码</a>来了解如何创建符号类型。</p><!--]--></div><footer class="page-meta"><!----><div class="meta-item last-updated"><span class="meta-item-label">更新时间: </span><span class="meta-item-info">2021/11/28 下午1:39:36</span></div><!----></footer><!----><!--[--><!--]--></main><!--]--></div><div style="width:0px;" class="catalog-container absolute top-0 right-0 h-full hidden lg:block"><div class="headings-container sticky top-36" data-v-c28348e0><ul class="max-w-max m-2 pl-7 xl:pl-16 2xl:pl-20 py-4 opacity-50 hover:opacity-100 transition-all duration-300" data-v-c28348e0><!--[--><!--]--></ul></div></div><div style="display:none;" tabindex="0" class="sidebar-container fixed inset-y-0 left-0 z-20 lg:hidden opacity-10 hover:opacity-95"><div class="headings-container px-2 space-y-2 transition-all duration-300 py-20" data-v-6eed9461><!--[--><!--]--></div></div></div><footer class="bg-gray-200 p-8 grid grid-cols-1 md:grid-cols-3 gap-4 items-center"><div class="flex justify-center md:justify-start items-center"><a class="p-2 hover:bg-gray-300 rounded-md" href="https://benbinbin.github.io/" target="_blank"><img src="/blog-data/images/avatar.png" alt="avatar" class="w-10 h-10 rounded-full"></a></div><div class="text-center space-y-0.5"><p class="text-sm text-gray-600"> ©2021 <span class="author">Benbinbin</span>. All Right Reserved. </p><p class="text-xs text-center text-gray-400"> 除特殊说明外，本站的文章遵循 <a href="https://creativecommons.org/licenses/by-sa/4.0/deed.en" target="_blank" class="text-blue-400">CC-BY-SA-4.0</a> 协议 </p><p class="text-xs text-center text-gray-400"> 网站主题采用 <a href="https://github.com/Benbinbin/two-dishes-one-fish" target="_blank" class="text-blue-400">Two Dishes One Fish</a></p></div><div class="btn-container flex justify-center md:justify-end items-center space-x-0.5"><!--[--><a class="p-2 hover:bg-gray-300 rounded-md" href="mailto:benthomsonbin@gmail.com" target=""><img src="/blog-data/images/icons/email.svg" alt="email" class="w-auto h-6"></a><a class="p-2 hover:bg-gray-300 rounded-md" href="https://github.com/Benbinbin" target="_blank"><img src="/blog-data/images/icons/github.svg" alt="github" class="w-auto h-6"></a><a class="p-2 hover:bg-gray-300 rounded-md" href="https://juejin.cn/user/3175045314389278/posts" target="_blank"><img src="/blog-data/images/icons/juejin.svg" alt="juejin" class="w-auto h-6"></a><a class="p-2 hover:bg-gray-300 rounded-md" href="https://dribbble.com/BinBinDesign" target="_blank"><img src="/blog-data/images/icons/dribbble.svg" alt="dribbble" class="w-auto h-6"></a><a class="p-2 hover:bg-gray-300 rounded-md" href="https://twitter.com/Benbinbin_fun" target="_blank"><img src="/blog-data/images/icons/twitter.svg" alt="twitter" class="w-auto h-6"></a><a class="p-2 hover:bg-gray-300 rounded-md" href="https://weibo.com/binbindesign" target="_blank"><img src="/blog-data/images/icons/weibo.svg" alt="weibo" class="w-auto h-6"></a><!--]--></div></footer></div><!--]--></div>
    <script type="module" src="/blog-data/assets/app.a4413a59.js" defer></script>
  </body>
</html>
